<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ ë‘ê·¼ë‘ê·¼ ë§ˆë‹ˆë˜ ì¶”ì²¨ê¸°</title>
    <style>
        :root {
            --primary: #FFB7B2; /* íŒŒìŠ¤í…” í•‘í¬ */
            --secondary: #B2E2F2; /* íŒŒìŠ¤í…” ë¸”ë£¨ */
            --accent: #FFDAC1; /* íŒŒìŠ¤í…” ì˜¤ë Œì§€ */
            --bg: #FDFCF0;
            --text: #5A5A5A;
        }

        * { box-sizing: border-box; font-family: 'Pretendard', sans-serif; }
        body { background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }

        .container { background: white; width: 100%; max-width: 600px; padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); text-align: center; }
        h1 { color: var(--primary); margin-bottom: 10px; font-size: 1.8rem; }
        p.desc { font-size: 0.9rem; color: #999; margin-bottom: 20px; }

        /* ì…ë ¥ ì˜ì—­ */
        .input-box { display: flex; gap: 8px; margin-bottom: 20px; }
        input { flex: 1; padding: 12px 15px; border: 2px solid var(--accent); border-radius: 12px; outline: none; font-size: 1rem; }
        button { cursor: pointer; border: none; border-radius: 12px; font-weight: bold; transition: all 0.2s; }
        .btn-add { background: var(--primary); color: white; padding: 0 20px; }
        .btn-add:hover { background: #ff9a94; transform: scale(1.05); }

        /* ì´ë¦„ ë¦¬ìŠ¤íŠ¸ */
        .name-tags { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-bottom: 20px; min-height: 40px; }
        .tag { background: #f0f0f0; padding: 6px 12px; border-radius: 20px; font-size: 0.9rem; display: flex; align-items: center; gap: 5px; animation: pop 0.3s ease; }
        .tag .del { color: #ff6b6b; cursor: pointer; font-weight: bold; margin-left: 5px; }
        @keyframes pop { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* ì œì–´ ë²„íŠ¼ */
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 30px; }
        .btn-start { background: var(--secondary); color: #446D7A; padding: 15px; font-size: 1rem; }
        .btn-start:hover { background: #92D1E5; transform: translateY(-2px); }
        .btn-reset { background: #eee; color: #888; padding: 15px; }
        .btn-reset:hover { background: #ddd; }

        /* ì‹œê°í™” ì˜ì—­ (ì›í˜• ë°°ì¹˜) */
        #viz-container {
            position: relative;
            width: 100%;
            height: 400px;
            margin: 20px 0;
            display: none; /* ì¶”ì²¨ ì „ê¹Œì§€ ìˆ¨ê¹€ */
            background: #fffdf9;
            border-radius: 20px;
            overflow: hidden;
        }
        .node {
            position: absolute;
            width: 70px;
            height: 70px;
            background: white;
            border: 3px solid var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.85rem;
            z-index: 2;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            transform: translate(-50%, -50%); /* ì¤‘ì‹¬ì  ê¸°ì¤€ ë°°ì¹˜ */
            transition: all 0.3s ease;
        }
        .node:hover { transform: translate(-50%, -50%) scale(1.1); z-index: 3; }

        svg#connections {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        /* í™”ì‚´í‘œ ì• ë‹ˆë©”ì´ì…˜ */
        .arrow-path {
            fill: none;
            stroke: var(--primary);
            stroke-width: 3;
            stroke-linecap: round;
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: drawArrow 1.5s ease-out forwards;
        }
        @keyframes drawArrow { to { stroke-dashoffset: 0; } }

        /* ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ í…ìŠ¤íŠ¸ */
        #result-text { margin-top: 20px; text-align: left; background: #f9f9f9; padding: 15px; border-radius: 15px; display: none; }
        .result-item { padding: 5px 0; border-bottom: 1px dashed #eee; display: flex; justify-content: space-between; }
        .result-item:last-child { border-bottom: none; }
        h4 { margin: 0 0 10px 0; color: var(--primary); }

        /* ë°˜ì‘í˜• */
        @media (max-width: 500px) {
            #viz-container { height: 320px; }
            .node { width: 60px; height: 60px; font-size: 0.75rem; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ ë§ˆë‹ˆë˜ ì¶”ì²¨ê¸°</h1>
    <p class="desc">ì´ë¦„ì„ ì¶”ê°€í•˜ê³  ë§ˆë‹ˆë˜ë¥¼ ì—°ê²°í•´ë³´ì„¸ìš”!</p>

    <div class="input-box">
        <input type="text" id="nameInput" placeholder="ì´ë¦„ ì…ë ¥ (ì—”í„°)" onkeypress="if(event.key==='Enter') addName()">
        <button class="btn-add" onclick="addName()">ì¶”ê°€</button>
    </div>

    <div id="nameTags" class="name-tags"></div>

    <div class="controls">
        <button class="btn-start" onclick="startManitto()">ë§ˆë‹ˆë˜ ì‹œì‘! âœ¨</button>
        <button class="btn-reset" onclick="resetAll()">ë¦¬ì…‹</button>
    </div>

    <div id="viz-container">
        <svg id="connections">
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#FFB7B2" />
                </marker>
            </defs>
        </svg>
    </div>

    <div id="result-text"></div>
</div>

<script>
    let members = [];

    // 1. ì´ë¦„ ì¶”ê°€
    function addName() {
        const input = document.getElementById('nameInput');
        const name = input.value.trim();
        if (!name) return;
        if (members.includes(name)) { alert("ì´ë¯¸ ìˆëŠ” ì´ë¦„ì´ì—ìš”!"); return; }
        
        members.push(name);
        input.value = "";
        renderTags();
    }

    // 2. íƒœê·¸ ë Œë”ë§
    function renderTags() {
        const container = document.getElementById('nameTags');
        container.innerHTML = members.map((m, i) => `
            <div class="tag">
                ${m} <span class="del" onclick="removeName(${i})">Ã—</span>
            </div>
        `).join('');
    }

    function removeName(index) {
        members.splice(index, 1);
        renderTags();
        resetView();
    }

    function resetView() {
        document.getElementById('viz-container').style.display = 'none';
        document.getElementById('result-text').style.display = 'none';
    }

    // 3. ë§ˆë‹ˆë˜ ì¶”ì²¨
    function startManitto() {
        if (members.length < 2) {
            alert("ìµœì†Œ 2ëª… ì´ìƒì´ í•„ìš”í•©ë‹ˆë‹¤!");
            return;
        }

        let shuffled = [...members];
        for (let i = shuffled.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }

        const results = [];
        for (let i = 0; i < shuffled.length; i++) {
            results.push({
                giver: shuffled[i],
                receiver: shuffled[(i + 1) % shuffled.length]
            });
        }

        drawVisualization(results);
        showResultText(results);
    }

    // 4. ì‹œê°í™” ê·¸ë¦¬ê¸° (ìˆ˜ì •ë¨)
    function drawVisualization(results) {
        const container = document.getElementById('viz-container');
        const svg = document.getElementById('connections');
        container.style.display = 'block';
        
        const paths = svg.querySelectorAll('.arrow-path');
        paths.forEach(p => p.remove());
        const nodes = container.querySelectorAll('.node');
        nodes.forEach(n => n.remove());

        const width = container.clientWidth;
        const height = container.clientHeight;
        const centerX = width / 2;
        const centerY = height / 2;
        const radius = Math.min(centerX, centerY) - 50;

        const coords = {};
        results.forEach((res, i) => {
            const angle = (i * 2 * Math.PI / results.length) - (Math.PI / 2);
            const x = centerX + radius * Math.cos(angle);
            const y = centerY + radius * Math.sin(angle);
            coords[res.giver] = { x, y };

            const node = document.createElement('div');
            node.className = 'node';
            node.innerText = res.giver;
            node.style.left = `${x}px`;
            node.style.top = `${y}px`;
            container.appendChild(node);
        });

        // ìˆ˜ì •ë¨: í™”ì‚´í‘œê°€ ë…¸ë“œ í…Œë‘ë¦¬ì—ì„œ ë©ˆì¶”ë„ë¡ ê³„ì‚° ì¶”ê°€
        const nodeRadiusOffset = 38; // ë…¸ë“œ ë°˜ì§€ë¦„(35px)ë³´ë‹¤ ì•½ê°„ ì—¬ìœ  ìˆê²Œ ì„¤ì •

        results.forEach((res, i) => {
            const start = coords[res.giver];
            const end = coords[res.receiver];

            // ë„ì°©ì  ì¡°ì • ë²¡í„° ê³„ì‚°
            const dx = end.x - start.x;
            const dy = end.y - start.y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            const ux = dx / dist; // ë‹¨ìœ„ ë²¡í„° x
            const uy = dy / dist; // ë‹¨ìœ„ ë²¡í„° y

            // ì¡°ì •ëœ ë„ì°©ì  (ì› ì¤‘ì‹¬ì—ì„œ ì‹œì‘ì  ë°©í–¥ìœ¼ë¡œ offsetë§Œí¼ ì´ë™)
            const endAdjX = end.x - ux * nodeRadiusOffset;
            const endAdjY = end.y - uy * nodeRadiusOffset;

            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            // ê³¡ì„  ì œì–´ì ì€ ì›ë˜ ì¤‘ì‹¬ì  ê¸°ì¤€ ìœ ì§€ (ìì—°ìŠ¤ëŸ¬ìš´ ê³¡ì„ ì„ ìœ„í•´)
            const midX = (start.x + end.x) / 2 + (Math.random() - 0.5) * 40;
            const midY = (start.y + end.y) / 2 + (Math.random() - 0.5) * 40;
            
            // path ë°ì´í„°ì— ì¡°ì •ëœ ë„ì°©ì  ì ìš©
            const d = `M ${start.x} ${start.y} Q ${midX} ${midY} ${endAdjX} ${endAdjY}`;
            path.setAttribute("d", d);
            path.setAttribute("class", "arrow-path");
            path.setAttribute("marker-end", "url(#arrowhead)");
            path.style.animationDelay = `${i * 0.3}s`;

            svg.appendChild(path);
        });
    }

    // 5. í…ìŠ¤íŠ¸ ê²°ê³¼ í‘œì‹œ
    function showResultText(results) {
        const resDiv = document.getElementById('result-text');
        resDiv.style.display = 'block';
        resDiv.innerHTML = "<h4>ğŸ“‹ ë§¤ì¹­ ëª…ë‹¨</h4>" + results.map(r => `
            <div class="result-item">
                <span><strong>${r.giver}</strong> ë‹˜</span>
                <span>â” <strong>${r.receiver}</strong> ë‹˜</span>
            </div>
        `).join('');
        resDiv.scrollIntoView({ behavior: 'smooth' }); // ê²°ê³¼ ìª½ìœ¼ë¡œ ìŠ¤í¬ë¡¤ ì´ë™
    }

    // 6. ë¦¬ì…‹
    function resetAll() {
        if (!confirm("ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”?")) return;
        members = [];
        renderTags();
        resetView();
        document.getElementById('nameInput').value = "";
    }
</script>

</body>
</html>